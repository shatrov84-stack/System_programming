# –ì–ª–∞–≤–∞ 4: Job-–æ–±—ä–µ–∫—Ç—ã üöÄ  
*–ì—Ä—É–ø–ø–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –≤ Windows*

---

## üéØ **–¶–µ–ª—å —É—Ä–æ–∫–∞**
–ù–∞—É—á–∏—Ç—å—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å Job-–æ–±—ä–µ–∫—Ç–∞–º–∏ ‚Äî –º–æ—â–Ω—ã–º –º–µ—Ö–∞–Ω–∏–∑–º–æ–º Windows –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è –≥—Ä—É–ø–ø –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

---

## üìñ **–ö—Ä–∞—Ç–∫–∞—è —Ç–µ–æ—Ä–∏—è**

### –ß—Ç–æ —Ç–∞–∫–æ–µ Job-–æ–±—ä–µ–∫—Ç?
**Job-–æ–±—ä–µ–∫—Ç** ‚Äî —ç—Ç–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –ø–æ–∑–≤–æ–ª—è—é—â–∏–π:
- ‚úÖ –£–ø—Ä–∞–≤–ª—è—Ç—å –≥—Ä—É–ø–ø–æ–π –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∫–∞–∫ –µ–¥–∏–Ω—ã–º —Ü–µ–ª—ã–º
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã (CPU, –ø–∞–º—è—Ç—å, –≤—Ä–µ–º—è)
- ‚úÖ –°–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ä–µ–¥—ã ("–ø–µ—Å–æ—á–Ω–∏—Ü—ã")
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≤–µ—Ä—à–∞—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã

### üìä –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
```plaintext
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ         Job-–æ–±—ä–µ–∫—Ç                  ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ  ‚îÇ Proc‚îÇ Proc‚îÇ Proc‚îÇ ... ‚îÇ          ‚îÇ
‚îÇ  ‚îÇ  1  ‚îÇ  2  ‚îÇ  3  ‚îÇ     ‚îÇ          ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                                      ‚îÇ
‚îÇ  –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:                        ‚îÇ
‚îÇ  ‚Ä¢ –ú–∞–∫—Å. –ø—Ä–æ—Ü–µ—Å—Å—ã: 5                 ‚îÇ
‚îÇ  ‚Ä¢ –õ–∏–º–∏—Ç –ø–∞–º—è—Ç–∏: 100MB              ‚îÇ
‚îÇ  ‚Ä¢ –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 30 —Å–µ–∫         ‚îÇ
‚îÇ  ‚Ä¢ –ê–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üõ† **–ü—Ä–∞–∫—Ç–∏–∫–∞: –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–±–æ—Ç–∞—é—â–∏–π –ø—Ä–∏–º–µ—Ä**

### 1. –°–æ–∑–¥–∞–µ–º Job-–æ–±—ä–µ–∫—Ç
```c
#include <windows.h>
#include <stdio.h>

int main() {
    // 1. –°–û–ó–î–ê–ù–ò–ï JOB-–û–ë–™–ï–ö–¢–ê
    HANDLE hJob = CreateJobObject(NULL, L"MyFirstJob");
    if (!hJob) {
        printf("‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è: %d\n", GetLastError());
        return 1;
    }
    printf("‚úÖ Job-–æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞–Ω!\n");
```

### 2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
```c
    // 2. –ù–ê–°–¢–†–û–ô–ö–ê –û–ì–†–ê–ù–ò–ß–ï–ù–ò–ô
    JOBOBJECT_EXTENDED_LIMIT_INFORMATION limits = {0};
    
    // –ö–∞–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –≤–∫–ª—é—á–∞–µ–º:
    limits.BasicLimitInformation.LimitFlags = 
        JOB_OBJECT_LIMIT_ACTIVE_PROCESS |   // –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —á–∏—Å–ª–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
        JOB_OBJECT_LIMIT_PROCESS_TIME |     // –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤—Ä–µ–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞
        JOB_OBJECT_LIMIT_JOB_MEMORY |       // –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø–∞–º—è—Ç—å Job
        JOB_OBJECT_LIMIT_KILL_ON_JOB_CLOSE; // –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ Job
    
    // –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
    limits.BasicLimitInformation.ActiveProcessLimit = 3; // –ú–∞–∫—Å 3 –ø—Ä–æ—Ü–µ—Å—Å–∞
    limits.JobMemoryLimit = 100 * 1024 * 1024;           // 100 MB –Ω–∞ –≤—Å—é Job
    
    // –ü—Ä–∏–º–µ–Ω—è–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:
    if (!SetInformationJobObject(hJob, JobObjectExtendedLimitInformation, 
                                &limits, sizeof(limits))) {
        printf("‚ùå –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: %d\n", GetLastError());
        CloseHandle(hJob);
        return 1;
    }
    printf("‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã!\n");
```

### 3. –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –≤ Job
```c
    // 3. –ó–ê–ü–£–°–ö –ü–†–û–¶–ï–°–°–ê –í JOB
    STARTUPINFO si = { sizeof(si) };
    PROCESS_INFORMATION pi = {0};
    
    // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å –ü–†–ò–û–°–¢–ê–ù–û–í–õ–ï–ù–ù–´–ú:
    if (!CreateProcess(
        L"C:\\Windows\\System32\\notepad.exe", // –ß—Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º
        NULL, NULL, NULL, FALSE,
        CREATE_SUSPENDED,  // ‚ö†Ô∏è –í–ê–ñ–ù–û: —Å–æ–∑–¥–∞–µ–º –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º!
        NULL, NULL, &si, &pi
    )) {
        printf("‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞: %d\n", GetLastError());
        CloseHandle(hJob);
        return 1;
    }
    
    // 4. –ù–ê–ó–ù–ê–ß–ê–ï–ú –ü–†–û–¶–ï–°–° –í JOB
    if (!AssignProcessToJobObject(hJob, pi.hProcess)) {
        printf("‚ùå –û—à–∏–±–∫–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ Job: %d\n", GetLastError());
        TerminateProcess(pi.hProcess, 1);
        CloseHandle(pi.hProcess);
        CloseHandle(pi.hThread);
        CloseHandle(hJob);
        return 1;
    }
    
    // 5. –ó–ê–ü–£–°–ö–ê–ï–ú –ü–†–û–¶–ï–°–°
    ResumeThread(pi.hThread);
    printf("‚úÖ –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—â–µ–Ω –≤ Job (PID: %lu)\n", pi.dwProcessId);
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–º –∏ –∑–∞–≤–µ—Ä—à–∞–µ–º
```c
    // 6. –ñ–î–ï–ú –ó–ê–í–ï–†–®–ï–ù–ò–Ø
    printf("‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (30 —Å–µ–∫)...\n");
    WaitForSingleObject(pi.hProcess, 30000);
    
    // 7. –°–¢–ê–¢–ò–°–¢–ò–ö–ê
    JOBOBJECT_BASIC_ACCOUNTING_INFO stats = {0};
    if (QueryInformationJobObject(hJob, JobObjectBasicAccountingInformation,
                                 &stats, sizeof(stats), NULL)) {
        printf("üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n");
        printf("   –ê–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: %lu\n", stats.ActiveProcesses);
        printf("   –í—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤: %lu\n", stats.TotalProcesses);
    }
    
    // 8. –û–ß–ò–°–¢–ö–ê
    CloseHandle(pi.hProcess);
    CloseHandle(pi.hThread);
    CloseHandle(hJob);
    
    printf("üéØ –ì–æ—Ç–æ–≤–æ! Job-–æ–±—ä–µ–∫—Ç —É–Ω–∏—á—Ç–æ–∂–µ–Ω.\n");
    return 0;
}
```

---

## üöÄ **–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ: "–ú–∏–Ω–∏-–ø–µ—Å–æ—á–Ω–∏—Ü–∞"**

### üìù –ó–∞–¥–∞–Ω–∏–µ:
–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É `sandbox.exe`, –∫–æ—Ç–æ—Ä–∞—è:
1. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø—É—Ç—å –∫ –ø—Ä–æ–≥—Ä–∞–º–º–µ –∫–∞–∫ –∞—Ä–≥—É–º–µ–Ω—Ç
2. –ó–∞–ø—É—Å–∫–∞–µ—Ç –µ–µ –≤ Job-–æ–±—ä–µ–∫—Ç–µ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏:
   - –ú–∞–∫—Å–∏–º—É–º 50MB –ø–∞–º—è—Ç–∏
   - –ú–∞–∫—Å–∏–º—É–º 60 —Å–µ–∫—É–Ω–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
   - –ê–≤—Ç–æ–∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ Job
3. –í—ã–≤–æ–¥–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### üí° –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
```bash
sandbox.exe notepad.exe
sandbox.exe "C:\Program Files\MyApp\app.exe"
```

### üéÅ –ü–æ–¥—Å–∫–∞–∑–∫–∏:
```c
// –î–ª—è —á—Ç–µ–Ω–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤:
int wmain(int argc, wchar_t* argv[]) {
    if (argc < 2) {
        printf("–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: sandbox.exe <–ø—Ä–æ–≥—Ä–∞–º–º–∞>\n");
        return 1;
    }
    LPCWSTR program = argv[1];
    // ... –≤–∞—à –∫–æ–¥ ...
}
```

---

## üìö **–®–ø–∞—Ä–≥–∞–ª–∫–∞ –ø–æ API**

| –§—É–Ω–∫—Ü–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|---------|------------|
| `CreateJobObject()` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π Job-–æ–±—ä–µ–∫—Ç |
| `SetInformationJobObject()` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è |
| `AssignProcessToJobObject()` | –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤ Job |
| `QueryInformationJobObject()` | –ü–æ–ª—É—á–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É |
| `TerminateJobObject()` | –ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ Job |

---

## ‚ö†Ô∏è **–í–∞–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã**

1. **–ü—Ä–æ—Ü–µ—Å—Å ‚Üí —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º Job**  
   –ü—Ä–æ—Ü–µ—Å—Å –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –º–µ–∂–¥—É Job-–æ–±—ä–µ–∫—Ç–∞–º–∏

2. **CREATE_SUSPENDED –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω**  
   –ò–Ω–∞—á–µ `AssignProcessToJobObject` –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å

3. **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø—Ä–∞–≤–∞**  
   –î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω—É–∂–Ω—ã –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

4. **KILL_ON_JOB_CLOSE**  
   –í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π—Ç–µ —ç—Ç–æ—Ç —Ñ–ª–∞–≥, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É

---

## üéØ **–ß–µ–∫    –ª–∏—Å—Ç —É—Ä–æ–∫–∞**

- [ ] –ü–æ–Ω—è–ª–∏, —á—Ç–æ —Ç–∞–∫–æ–µ Job-–æ–±—ä–µ–∫—Ç
- [ ] –ù–∞—É—á–∏–ª–∏—Å—å —Å–æ–∑–¥–∞–≤–∞—Ç—å Job —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏
- [ ] –ó–∞–ø—É—Å—Ç–∏–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å –≤–Ω—É—Ç—Ä–∏ Job
- [ ] –£–≤–∏–¥–µ–ª–∏, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –≥—Ä—É–ø–ø–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- [ ] –°–æ–∑–¥–∞–ª–∏ —Å–≤–æ—é "–ø–µ—Å–æ—á–Ω–∏—Ü—É"

---

## üîó **–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏**
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Microsoft](https://docs.microsoft.com/windows/win32/procthread/job-objects)

---

**üí° –°–æ–≤–µ—Ç:** –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫ —á–µ—Ä–µ–∑ `GetLastError()` ‚Äî —ç—Ç–æ —Å—ç–∫–æ–Ω–æ–º–∏—Ç —á–∞—Å—ã –æ—Ç–ª–∞–¥–∫–∏!

**–£–¥–∞—á–∏ –≤ –æ—Å–≤–æ–µ–Ω–∏–∏ Job-–æ–±—ä–µ–∫—Ç–æ–≤!** üöÄ
